version: "3.9"

services:
  servidor_backup:
    image: alpine:latest
    container_name: servidor_backup
    ports:
      - "873:873"
    volumes:
      - /setup/local/respaldo:/data
    networks:
      red_servidores:
        ipv4_address: 172.172.20.20
    restart: always
    command: sh -c "apk add --no-cache rsync && adduser -D backupuser && echo 'backupuser:secret123' > /etc/rsyncd.secrets && chmod 600 /etc/rsyncd.secrets && echo 'uid = backupuser\ngid = backupuser\nuse chroot = no\nmax connections = 2\nlog file = /var/log/rsyncd.log\ntimeout = 300\nauth users = backupuser\nsecrets file = /etc/rsyncd.secrets\n\n[respaldo]\n  path = /data\n  comment = Carpeta de respaldo\n  read only = no\n  list = yes' > /etc/rsyncd.conf && rsync --daemon --no-detach"

networks:
  red_servidores:
    external: true
    name: chemait_red_servidores
